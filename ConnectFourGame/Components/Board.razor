@inject GameStateService GameState


    
        
@if
 
(
GameWinner 
==
 
0
)

        
{

            
Current
 Player
:
 Player @CurrentPlayer
        
}

        
else

        
{

            ðŸŽ‰ Player @GameWinner Wins
!
 ðŸŽ‰
        
}

    

    
        
@for
 
(
int
 col 
=
 
0
;
 col 
<
 
7
;
 col
++
)

        
{

            
int
 currentCol 
=
 col
;

            
                â†“
            
        
}


        
@for
 
(
int
 row 
=
 
0
;
 row 
<
 
6
;
 row
++
)

        
{

            @
for
 
(
int
 col 
=
 
0
;
 col 
<
 
7
;
 col
++
)

            
{

                
            
}

        
}

    

    
        
            ðŸ”„ New Game
        
    


@code {
    private int[,] Board = new int[7, 6];
    private int CurrentPlayer = 1;
    private int GameWinner = 0;
    private List WinningCells = new();

    private void ResetGame()
    {
        Board = new int[7, 6];
        CurrentPlayer = 1;
        GameWinner = 0;
        WinningCells.Clear();
    }

    private void PlayPiece(int column)
    {
        if (GameWinner != 0) return;

        // Find the lowest empty row in the column
        for (int row = 5; row >= 0; row--)
        {
            if (Board[column, row] == 0)
            {
                Board[column, row] = CurrentPlayer;
                CheckForWinner(column, row);
                
                if (GameWinner != 0)
                {
                    GameState.RecordWin(GameWinner);
                }
                else
                {
                    CurrentPlayer = CurrentPlayer == 1 ? 2 : 1;
                }
                
                return;
            }
        }
    }

    private void CheckForWinner(int lastCol, int lastRow)
    {
        int player = Board[lastCol, lastRow];

        // Check horizontal
        var horizontal = CheckDirection(lastCol, lastRow, 1, 0);
        if (horizontal.Count >= 4)
        {
            GameWinner = player;
            WinningCells = horizontal;
            return;
        }

        // Check vertical
        var vertical = CheckDirection(lastCol, lastRow, 0, 1);
        if (vertical.Count >= 4)
        {
            GameWinner = player;
            WinningCells = vertical;
            return;
        }

        // Check diagonal (down-right)
        var diagonal1 = CheckDirection(lastCol, lastRow, 1, 1);
        if (diagonal1.Count >= 4)
        {
            GameWinner = player;
            WinningCells = diagonal1;
            return;
        }

        // Check diagonal (up-right)
        var diagonal2 = CheckDirection(lastCol, lastRow, 1, -1);
        if (diagonal2.Count >= 4)
        {
            GameWinner = player;
            WinningCells = diagonal2;
            return;
        }
    }

    private List CheckDirection(int col, int row, int deltaCol, int deltaRow)
    {
        int player = Board[col, row];
        var cells = new List { (col, row) };

        // Check positive direction
        int c = col + deltaCol;
        int r = row + deltaRow;
        while (c >= 0 && c < 7 && r >= 0 && r < 6 && Board[c, r] == player)
        {
            cells.Add((c, r));
            c += deltaCol;
            r += deltaRow;
        }

        // Check negative direction
        c = col - deltaCol;
        r = row - deltaRow;
        while (c >= 0 && c < 7 && r >= 0 && r < 6 && Board[c, r] == player)
        {
            cells.Add((c, r));
            c -= deltaCol;
            r -= deltaRow;
        }

        return cells;
    }
}